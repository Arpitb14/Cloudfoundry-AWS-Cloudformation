{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Versioned & Replicated S3 Backup Bucket: Source Bucket and Destination Configuration - to be added to source region",

  "Parameters": {
    "SourceBucketExpirationInDays": {
      "Type": "Number",
      "Default": "365",
      "MinValue": "1",
      "Description": "Source Bucket Expiration in Days"
    },
    "DestinationRoleArn": {
      "Type": "String",
      "Description": "Destination Bucket Replication Role ARN",
      "AllowedPattern": "^arn:aws:iam::[0-9]+:[a-z]*/[A-Za-z0-9/-]+$",
      "ConstraintDescription": "Destination Bucket Replication Role ARN"
    },
    "DestinationBucketArn": {
      "Type": "String",
      "Description": "Destination Bucket Bucket ARN",
      "AllowedPattern": "^arn:aws:s3::[0-9]*:[A-Za-z0-9/-]+$",
      "ConstraintDescription": "Destination Bucket ARN"
    }
  },

  "Outputs": {
    "BackupBucket": {
      "Description": "Backup Bucket",
      "Value": { "Ref": "BackupBucket" }
    }
  },

  "Resources": {
    "BackupBucket": {
      "Type": "AWS::S3::Bucket",
      "Properties": {
        "LifecycleConfiguration": {
          "Rules": [
            {
              "ExpirationInDays": { "Ref": "SourceBucketExpirationInDays" },
              "Status": "Enabled"
            }
          ]
        },
        "ReplicationConfiguration": {
          "Role": { "Ref": "DestinationRoleArn" },
          "Rules": [
            {
              "Destination": {
                "Bucket": { "Ref": "DestinationBucketArn" }
              },
              "Prefix": "",
              "Status": "Enabled"
            }
          ]
        },
        "VersioningConfiguration": { "Status": "Enabled" }
      }
    }
  }
}
