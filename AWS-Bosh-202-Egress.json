{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "Egress Security Rules: inter-Cloudfoundry & services networking",

  "Parameters": {
    "DeploymentName": {
      "Type": "String",
      "Description": "Deployment Name",
      "MinLength": "1",
      "MaxLength": "16",
      "AllowedPattern": "^([A-Za-z0-9]+[A-Za-z0-9-]?)+[A-Za-z0-9]$",
      "ConstraintDescription": "Must be a valid domain label matching /^([A-Za-z0-9]+[A-Za-z0-9-])+[A-Za-z0-9]$/"
    },
    "CreateElastiCacheInfrastructure": {
      "Type": "String",
      "Default": "true",
      "Description": "Create ElastiCache Networks",
      "AllowedValues": [ "true", "false" ]
    },
    "CreateRabbitmqNetworks": {
      "Type": "String",
      "Default": "true",
      "Description": "Create RabbitMQ network(s)",
      "AllowedValues": [ "true", "false" ]
    },
    "DeployAppsRdsInstance": {
      "Type": "String",
      "Default": "true",
      "Description": "Deploy Apps RDS Instance",
      "AllowedValues": [ "true", "false" ]
    },
    "DeployCfRdsInstance": {
      "Type": "String",
      "Default": "true",
      "Description": "Deploy Cf RDS Instance",
      "AllowedValues": [ "true", "false" ]
    },
    "ExternalRdsAz1Cidr": {
      "Type": "String",
      "Default": "",
      "Description": "External RDS Database AZ1 CIDR",
      "AllowedPattern": "^((([01][0-9]?[0-9]?|2[0-4][0-9]|25[0-5])\.){3}([01][0-9]?[0-9]?|2[0-4][0-9]|25[0-5])/([0-2]?[0-9]|3[0-2]))?$",
      "ConstraintDescription": "Valid CIDR"
    },
    "ExternalRdsAz2Cidr": {
      "Type": "String",
      "Default": "",
      "Description": "External RDS Database AZ2 CIDR",
      "AllowedPattern": "^((([01][0-9]?[0-9]?|2[0-4][0-9]|25[0-5])\.){3}([01][0-9]?[0-9]?|2[0-4][0-9]|25[0-5])/([0-2]?[0-9]|3[0-2]))?",
      "ConstraintDescription": "Valid CIDR"
    },
    "ExternalRdsAz3Cidr": {
      "Type": "String",
      "Default": "",
      "Description": "External RDS Database AZ3 CIDR",
      "AllowedPattern": "^((([01][0-9]?[0-9]?|2[0-4][0-9]|25[0-5])\.){3}([01][0-9]?[0-9]?|2[0-4][0-9]|25[0-5])/([0-2]?[0-9]|3[0-2]))?",
      "ConstraintDescription": "Valid CIDR"
    },
    "ExternalRdsPort": {
      "Type": "Number",
      "Default": "5432",
      "MinValue": "1024",
      "MaxValue": "65535",
      "Description": "External RDS Port"
    },
    "ExternalRabbitmqAz1Cidr": {
      "Type": "String",
      "Default": "",
      "Description": "External RabbitMQ CIDR AZ1",
      "AllowedPattern": "^((([01][0-9]?[0-9]?|2[0-4][0-9]|25[0-5])\.){3}([01][0-9]?[0-9]?|2[0-4][0-9]|25[0-5])/([0-2]?[0-9]|3[0-2]))?$",
      "ConstraintDescription": "Valid CIDR"
    },
    "ExternalRabbitmqAz2Cidr": {
      "Type": "String",
      "Default": "",
      "Description": "External RabbitMQ CIDR AZ2",
      "AllowedPattern": "^((([01][0-9]?[0-9]?|2[0-4][0-9]|25[0-5])\.){3}([01][0-9]?[0-9]?|2[0-4][0-9]|25[0-5])/([0-2]?[0-9]|3[0-2]))?$",
      "ConstraintDescription": "Valid CIDR"
    },
    "ExternalRabbitmqAz3Cidr": {
      "Type": "String",
      "Default": "",
      "Description": "External RabbitMQ CIDR AZ3",
      "AllowedPattern": "^((([01][0-9]?[0-9]?|2[0-4][0-9]|25[0-5])\.){3}([01][0-9]?[0-9]?|2[0-4][0-9]|25[0-5])/([0-2]?[0-9]|3[0-2]))?$",
      "ConstraintDescription": "Valid CIDR"
    },
    "ExternalRabbitmqPort1": {
      "Type": "Number",
      "Default": "5672",
      "MinValue": "1024",
      "MaxValue": "65535",
      "Description": "External RabbitMQ Port 1"
    },
    "ExternalRabbitmqPort2": {
      "Type": "Number",
      "Default": "5672",
      "MinValue": "1024",
      "MaxValue": "65535",
      "Description": "External RabbitMQ Port 2"
    },
    "ExternalNtpCidr1": {
      "Type": "String",
      "Default": "0.0.0.0/0",
      "Description": "External NTP CIDR 1",
      "AllowedPattern": "^((([01][0-9]?[0-9]?|2[0-4][0-9]|25[0-5])\.){3}([01][0-9]?[0-9]?|2[0-4][0-9]|25[0-5])/([0-2]?[0-9]|3[0-2]))?$",
      "ConstraintDescription": "Valid CIDR"
    },
    "ExternalNtpCidr2": {
      "Type": "String",
      "Default": "",
      "Description": "External NTP CIDR 2",
      "AllowedPattern": "^((([01][0-9]?[0-9]?|2[0-4][0-9]|25[0-5])\.){3}([01][0-9]?[0-9]?|2[0-4][0-9]|25[0-5])/([0-2]?[0-9]|3[0-2]))?$",
      "ConstraintDescription": "Valid CIDR"
    },
    "ExternalNtpCidr3": {
      "Type": "String",
      "Default": "",
      "Description": "External NTP CIDR 3",
      "AllowedPattern": "^((([01][0-9]?[0-9]?|2[0-4][0-9]|25[0-5])\.){3}([01][0-9]?[0-9]?|2[0-4][0-9]|25[0-5])/([0-2]?[0-9]|3[0-2]))?$",
      "ConstraintDescription": "Valid CIDR"
    },
    "ExternalSyslogCidr1": {
      "Type": "String",
      "Default": "",
      "Description": "External Syslog Main CIDR",
      "AllowedPattern": "^((([01][0-9]?[0-9]?|2[0-4][0-9]|25[0-5])\.){3}([01][0-9]?[0-9]?|2[0-4][0-9]|25[0-5])/([0-2]?[0-9]|3[0-2]))?$",
      "ConstraintDescription": "Valid CIDR"
    },
    "ExternalSyslogCidr2": {
      "Type": "String",
      "Default": "",
      "Description": "External Syslog Fallback CIDR 1",
      "AllowedPattern": "^((([01][0-9]?[0-9]?|2[0-4][0-9]|25[0-5])\.){3}([01][0-9]?[0-9]?|2[0-4][0-9]|25[0-5])/([0-2]?[0-9]|3[0-2]))?$",
      "ConstraintDescription": "Valid CIDR"
    },
    "ExternalSyslogCidr3": {
      "Type": "String",
      "Default": "",
      "Description": "External Syslog Fallback CIDR 2",
      "AllowedPattern": "^(([0-9]{1,3}\\.){3}[0-9]{1,3}/[0-3][0-9])?$",
      "ConstraintDescription": "Valid CIDR"
    },
    "ExternalSyslogPort": {
      "Type": "Number",
      "Default": "514",
      "MinValue": "1",
      "MaxValue": "65535",
      "Description": "External Syslog Port"
    },
    "ExternalSyslogProtocol": {
      "Type": "String",
      "Default": "tcp",
      "Description": "External Syslog Protocol",
      "AllowedValues": [ "tcp", "udp" ]
    },
    "DeployElb": {
      "Type": "String",
      "Default": "true",
      "Description": "Deploy External ELB",
      "AllowedValues": [ "true", "false" ]
    },
    "MultiAz": {
      "Type": "String",
      "Default": "true",
      "Description": "MultiAz",
      "AllowedValues": [ "true", "false" ]
    }
  },

  "Outputs": {
    "ExternalSyslogCidr1": {
      "Description": "External Syslog Main IP",
      "Condition": "WhitelistExternalSyslogCidr1",
      "Value": { "Ref": "ExternalSyslogCidr1" }
    },
    "ExternalSyslogCidr2": {
      "Description": "External Syslog Fallback IP 1",
      "Condition": "WhitelistExternalSyslogCidr2",
      "Value": { "Ref": "ExternalSyslogCidr2" }
    },
    "ExternalSyslogCidr3": {
      "Description": "External Syslog Fallback IP 2",
      "Condition": "WhitelistExternalSyslogCidr3",
      "Value": { "Ref": "ExternalSyslogCidr3" }
    },
    "ExternalSyslogPort": {
      "Description": "External Syslog Port",
      "Value": { "Ref": "ExternalSyslogPort" }
    },
    "ExternalSyslogProtocol": {
      "Description": "External Syslog Protocol",
      "Value": { "Ref": "ExternalSyslogProtocol" }
    }
  },

  "Conditions": {
    "CreateElastiCacheInfrastructure": { "Fn::Equals": [ { "Ref": "CreateElastiCacheInfrastructure" }, "true" ] },
    "CreateRabbitmqNetworks": { "Fn::Equals": [ { "Ref": "CreateRabbitmqNetworks" }, "true" ] },
    "DeployAppsRdsInstance": { "Fn::Equals": [ { "Ref": "DeployAppsRdsInstance" }, "true" ] },
    "DeployCfRdsInstance": { "Fn::Equals": [ { "Ref": "DeployCfRdsInstance" }, "true" ] },
    "DeployElb": { "Fn::Equals": [ { "Ref": "DeployElb" }, "true" ] },
    "MultiAz": { "Fn::Equals": [ { "Ref": "MultiAz" }, "true" ] },
    "MultiAzAndDeployElb": {
      "Fn::And": [
        { "Fn::Equals": [ { "Ref": "MultiAz" }, "true" ] },
        { "Fn::Equals": [ { "Ref": "DeployElb" }, "true" ] }
      ]
    },
    "MultiAzAndCreateRabbitmqNetworks": {
      "Fn::And": [
        { "Fn::Equals": [ { "Ref": "MultiAz" }, "true" ] },
        { "Fn::Equals": [ { "Ref": "CreateRabbitmqNetworks" }, "true" ] }
      ]
    },
    "WhitelistExternalRdsAz1Cidr": { "Fn::Not": [ { "Fn::Equals": [ { "Ref": "ExternalRdsAz1Cidr" }, "" ] } ] },
    "WhitelistExternalRdsAz2Cidr": { "Fn::Not": [ { "Fn::Equals": [ { "Ref": "ExternalRdsAz2Cidr" }, "" ] } ] },
    "WhitelistExternalRdsAz3Cidr": { "Fn::Not": [ { "Fn::Equals": [ { "Ref": "ExternalRdsAz3Cidr" }, "" ] } ] },

    "WhitelistExternalRabbitmqAz1Cidr": { "Fn::Not": [ { "Fn::Equals": [ { "Ref": "ExternalRabbitmqAz1Cidr" }, "" ] } ] },
    "WhitelistExternalRabbitmqAz2Cidr": { "Fn::Not": [ { "Fn::Equals": [ { "Ref": "ExternalRabbitmqAz2Cidr" }, "" ] } ] },
    "WhitelistExternalRabbitmqAz3Cidr": { "Fn::Not": [ { "Fn::Equals": [ { "Ref": "ExternalRabbitmqAz3Cidr" }, "" ] } ] },

    "WhitelistExternalRabbitmqAz1CidrPort2": {
      "Fn::And": [
        { "Fn::Not": [ { "Fn::Equals": [ { "Ref": "ExternalRabbitmqPort1" }, { "Ref": "ExternalRabbitmqPort2" } ] } ] },
        { "Fn::Not": [ { "Fn::Equals": [ { "Ref": "ExternalRabbitmqAz1Cidr" }, "" ] } ] }
      ]
    },
    "WhitelistExternalRabbitmqAz2CidrPort2": {
      "Fn::And": [
        { "Fn::Not": [ { "Fn::Equals": [ { "Ref": "ExternalRabbitmqPort1" }, { "Ref": "ExternalRabbitmqPort2" } ] } ] },
        { "Fn::Not": [ { "Fn::Equals": [ { "Ref": "ExternalRabbitmqAz2Cidr" }, "" ] } ] }
      ]
    },
    "WhitelistExternalRabbitmqAz3CidrPort2": {
      "Fn::And": [
        { "Fn::Not": [ { "Fn::Equals": [ { "Ref": "ExternalRabbitmqPort1" }, { "Ref": "ExternalRabbitmqPort2" } ] } ] },
        { "Fn::Not": [ { "Fn::Equals": [ { "Ref": "ExternalRabbitmqAz3Cidr" }, "" ] } ] }
      ]
    },

    "WhitelistExternalNtpCidr1": { "Fn::Not": [ { "Fn::Equals": [ { "Ref": "ExternalNtpCidr1" }, "" ] } ] },
    "WhitelistExternalNtpCidr2": {
      "Fn::And": [
        { "Fn::Not": [ { "Fn::Equals": [ { "Ref": "ExternalNtpCidr1" }, "" ] } ] },
        { "Fn::Not": [ { "Fn::Equals": [ { "Ref": "ExternalNtpCidr2" }, "" ] } ] }
      ]
    },
    "WhitelistExternalNtpCidr3": {
      "Fn::And": [
        { "Fn::Not": [ { "Fn::Equals": [ { "Ref": "ExternalNtpCidr1" }, "" ] } ] },
        { "Fn::Not": [ { "Fn::Equals": [ { "Ref": "ExternalNtpCidr2" }, "" ] } ] },
        { "Fn::Not": [ { "Fn::Equals": [ { "Ref": "ExternalNtpCidr3" }, "" ] } ] }
      ]
    },

    "WhitelistExternalSyslogCidr1": { "Fn::Not": [ { "Fn::Equals": [ { "Ref": "ExternalSyslogCidr1" }, "" ] } ] },
    "WhitelistExternalSyslogCidr2": {
      "Fn::And": [
        { "Fn::Not": [ { "Fn::Equals": [ { "Ref": "ExternalSyslogCidr1" }, "" ] } ] },
        { "Fn::Not": [ { "Fn::Equals": [ { "Ref": "ExternalSyslogCidr2" }, "" ] } ] }
      ]
    },
    "WhitelistExternalSyslogCidr3": {
      "Fn::And": [
        { "Fn::Not": [ { "Fn::Equals": [ { "Ref": "ExternalSyslogCidr1" }, "" ] } ] },
        { "Fn::Not": [ { "Fn::Equals": [ { "Ref": "ExternalSyslogCidr2" }, "" ] } ] },
        { "Fn::Not": [ { "Fn::Equals": [ { "Ref": "ExternalSyslogCidr3" }, "" ] } ] }
      ]
    }
  },

  "Mappings": {
    "PrefixLists": {
      "ap-northeast-1": {
        "s3": "pl-61a54008"
      },
      "ap-northeast-2": {
        "s3": "pl-78a54011"
      },
      "ap-south-1": {
        "s3": "pl-78a54011"
      },
      "ap-southeast-1": {
        "s3": "pl-6fa54006"
      },
      "ap-southeast-2": {
        "s3": "pl-6ca54005"
      },
      "ca-central-1": {
        "s3": "pl-7da54014"
      },
      "eu-central-1": {
        "s3": "pl-6ea54007"
      },
      "eu-west-1": {
        "s3": "pl-6da54004"
      },
      "eu-west-2": {
        "s3": "pl-7ca54015"
      },
      "sa-east-1": {
        "s3": "pl-6aa54003"
      },
      "us-east-1": {
        "s3": "pl-63a5400a"
      },
      "us-east-2": {
        "s3": "pl-7ba54012"
      },
      "us-west-1": {
        "s3": "pl-6ba54002"
      },
      "us-west-2": {
        "s3": "pl-68a54001"
      }
    }
  },

  "Resources": {
    "ApplicationLbSecurityGroupToRouterSecurityGroupPort80": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-LbSecurityGroup" } },
        "DestinationSecurityGroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RouterSecurityGroup" } },
        "FromPort": "80",
        "ToPort": "80" ,
        "IpProtocol": "tcp"
      }
    },
    "ApplicationLbSecurityGroupToRouterSecurityGroupPort443": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-LbSecurityGroup" } },
        "DestinationSecurityGroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RouterSecurityGroup" } },
        "FromPort": "443",
        "ToPort": "443" ,
        "IpProtocol": "tcp"
      }
    },

    "DirectorToS3PrefixListPort80": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorInstanceSecurityGroup" } },
        "DestinationPrefixListId": { "Fn::FindInMap": [ "PrefixLists", { "Ref": "AWS::Region" }, "s3" ] },
        "FromPort": "80",
        "ToPort": "80",
        "IpProtocol": "tcp"
      }
    },
    "DirectorToS3PrefixListPort443": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorInstanceSecurityGroup" } },
        "DestinationPrefixListId": { "Fn::FindInMap": [ "PrefixLists", { "Ref": "AWS::Region" }, "s3" ] },
        "FromPort": "443",
        "ToPort": "443",
        "IpProtocol": "tcp"
      }
    },
    "DirectorToPort80": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorInstanceSecurityGroup" } },
        "CidrIp": "0.0.0.0/0",
        "FromPort": "80",
        "ToPort": "80",
        "IpProtocol": "tcp"
      }
    },
    "DirectorToPort443": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorInstanceSecurityGroup" } },
        "CidrIp": "0.0.0.0/0",
        "FromPort": "443",
        "ToPort": "443",
        "IpProtocol": "tcp"
      }
    },

    "DirectorElbToDirectorAz1Port22": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "DeployElb",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorElbSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorAz1Cidr" } },
        "FromPort": "22",
        "ToPort": "22" ,
        "IpProtocol": "tcp"
      }
    },
    "DirectorElbToDirectorAz2Port22": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "DeployElb",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorElbSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorAz2Cidr" } },
        "FromPort": "22",
        "ToPort": "22" ,
        "IpProtocol": "tcp"
      }
    },
    "DirectorElbToDirectorAz1Port6868": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "DeployElb",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorElbSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorAz1Cidr" } },
        "FromPort": "6868",
        "ToPort": "6868" ,
        "IpProtocol": "tcp"
      }
    },
    "DirectorElbToDirectorAz2Port6868": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "DeployElb",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorElbSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorAz2Cidr" } },
        "FromPort": "6868",
        "ToPort": "6868" ,
        "IpProtocol": "tcp"
      }
    },
    "DirectorElbToDirectorAz1Port25555": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "DeployElb",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorElbSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorAz1Cidr" } },
        "FromPort": "25555",
        "ToPort": "25555" ,
        "IpProtocol": "tcp"
      }
    },
    "DirectorElbToDirectorAz2Port25555": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "DeployElb",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorElbSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorAz2Cidr" } },
        "FromPort": "25555",
        "ToPort": "25555" ,
        "IpProtocol": "tcp"
      }
    },

    "DirectorInstanceToPrivateAz1Port22": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorInstanceSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateAz1Cidr" } },
        "FromPort": "22",
        "ToPort": "22" ,
        "IpProtocol": "tcp"
      }
    },
    "DirectorInstanceToPrivateAz2Port22": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "MultiAz",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorInstanceSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateAz2Cidr" } },
        "FromPort": "22",
        "ToPort": "22" ,
        "IpProtocol": "tcp"
      }
    },
    "DirectorInstanceToPrivateAz3Port22": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "MultiAz",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorInstanceSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateAz3Cidr" } },
        "FromPort": "22",
        "ToPort": "22" ,
        "IpProtocol": "tcp"
      }
    },
    "DirectorInstanceToPrivateAz1Port6868": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorInstanceSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateAz1Cidr" } },
        "FromPort": "6868",
        "ToPort": "6868" ,
        "IpProtocol": "tcp"
      }
    },
    "DirectorInstanceToPrivateAz2Port6868": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "MultiAz",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorInstanceSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateAz2Cidr" } },
        "FromPort": "6868",
        "ToPort": "6868" ,
        "IpProtocol": "tcp"
      }
    },
    "DirectorInstanceToPrivateAz3Port6868": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "MultiAz",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorInstanceSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateAz3Cidr" } },
        "FromPort": "6868",
        "ToPort": "6868" ,
        "IpProtocol": "tcp"
      }
    },
    "DirectorInstanceToRabbitmqAz1Port22": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "CreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorInstanceSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqAz1Cidr" } },
        "FromPort": "22",
        "ToPort": "22" ,
        "IpProtocol": "tcp"
      }
    },
    "DirectorInstanceToRabbitmqAz2Port22": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "MultiAzAndCreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorInstanceSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqAz2Cidr" } },
        "FromPort": "22",
        "ToPort": "22" ,
        "IpProtocol": "tcp"
      }
    },
    "DirectorInstanceToRabbitmqAz1Port6868": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "CreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorInstanceSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqAz1Cidr" } },
        "FromPort": "6868",
        "ToPort": "6868" ,
        "IpProtocol": "tcp"
      }
    },
    "DirectorInstanceToRabbitmqAz2Port6868": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "MultiAzAndCreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorInstanceSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqAz2Cidr" } },
        "FromPort": "6868",
        "ToPort": "6868" ,
        "IpProtocol": "tcp"
      }
    },
    "DirectorInstanceToExternalSyslogCidr1": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalSyslogCidr1",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorInstanceSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalSyslogCidr1" },
        "FromPort": { "Ref": "ExternalSyslogPort" },
        "ToPort": { "Ref": "ExternalSyslogPort" },
        "IpProtocol": { "Ref": "ExternalSyslogProtocol" }
      }
    },
    "DirectorInstanceToExternalSyslogCidr2": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalSyslogCidr2",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorInstanceSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalSyslogCidr2" },
        "FromPort": { "Ref": "ExternalSyslogPort" },
        "ToPort": { "Ref": "ExternalSyslogPort" },
        "IpProtocol": { "Ref": "ExternalSyslogProtocol" }
      }
    },
    "DirectorInstanceToExternalSyslogCidr3": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalSyslogCidr3",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorInstanceSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalSyslogCidr3" },
        "FromPort": { "Ref": "ExternalSyslogPort" },
        "ToPort": { "Ref": "ExternalSyslogPort" },
        "IpProtocol": { "Ref": "ExternalSyslogProtocol" }
      }
    },
    "DirectorInstanceToExternalNtpCidr1": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalNtpCidr1",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorInstanceSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalNtpCidr1" },
        "FromPort": "123",
        "ToPort": "123",
        "IpProtocol": "udp"
      }
    },
    "DirectorInstanceToExternalNtpCidr2": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalNtpCidr2",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorInstanceSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalNtpCidr2" },
        "FromPort": "123",
        "ToPort": "123",
        "IpProtocol": "udp"
      }
    },
    "DirectorInstanceToExternalNtpCidr3": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalNtpCidr3",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorInstanceSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalNtpCidr3" },
        "FromPort": "123",
        "ToPort": "123",
        "IpProtocol": "udp"
      }
    },

    "DmzToExternalSyslogCidr1": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalSyslogCidr1",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DmzSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalSyslogCidr1" },
        "FromPort": { "Ref": "ExternalSyslogPort" },
        "ToPort": { "Ref": "ExternalSyslogPort" },
        "IpProtocol": { "Ref": "ExternalSyslogProtocol" }
      }
    },
    "DmzToExternalSyslogCidr2": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalSyslogCidr2",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DmzSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalSyslogCidr2" },
        "FromPort": { "Ref": "ExternalSyslogPort" },
        "ToPort": { "Ref": "ExternalSyslogPort" },
        "IpProtocol": { "Ref": "ExternalSyslogProtocol" }
      }
    },
    "DmzToExternalSyslogCidr3": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalSyslogCidr3",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DmzSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalSyslogCidr3" },
        "FromPort": { "Ref": "ExternalSyslogPort" },
        "ToPort": { "Ref": "ExternalSyslogPort" },
        "IpProtocol": { "Ref": "ExternalSyslogProtocol" }
      }
    },
    "DmzToExternalNtpCidr1": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalNtpCidr1",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DmzSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalNtpCidr1" },
        "FromPort": "123",
        "ToPort": "123",
        "IpProtocol": "udp"
      }
    },
    "DmzToExternalNtpCidr2": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalNtpCidr2",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DmzSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalNtpCidr2" },
        "FromPort": "123",
        "ToPort": "123",
        "IpProtocol": "udp"
      }
    },
    "DmzToExternalNtpCidr3": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalNtpCidr3",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DmzSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalNtpCidr3" },
        "FromPort": "123",
        "ToPort": "123",
        "IpProtocol": "udp"
      }
    },


    "LbSecurityGroupToRouterGroupPort8080": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "MultiAzAndDeployElb",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-LbSecurityGroup" } },
        "DestinationSecurityGroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RouterSecurityGroup" } },
        "FromPort": "8080",
        "ToPort": "8080" ,
        "IpProtocol": "tcp"
      }
    },
   "CfSshElbSecurityGroupToCfSshInstanceSecurityGroup": {
     "Type": "AWS::EC2::SecurityGroupEgress",
     "Condition": "DeployElb",
     "Properties": {
       "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-CfSshElbSecurityGroup" } },
       "DestinationSecurityGroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-CfSshInstanceSecurityGroup" } },
       "FromPort": "2222",
       "ToPort": "2223",
       "IpProtocol": "tcp"
     }
   },

    "PrivateToPort80": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": "0.0.0.0/0",
        "FromPort": "80",
        "ToPort": "80",
        "IpProtocol": "tcp"
      }
    },
    "PrivateToPort443": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": "0.0.0.0/0",
        "FromPort": "443",
        "ToPort": "443",
        "IpProtocol": "tcp"
      }
    },
    "PrivateToDirectorInstanceAz1Port4222": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorAz1Cidr" } },
        "FromPort": "4222",
        "ToPort": "4222" ,
        "IpProtocol": "tcp"
      }
    },
    "PrivateToDirectorInstanceAz2Port4222": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "MultiAz",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorAz2Cidr" } },
        "FromPort": "4222",
        "ToPort": "4222" ,
        "IpProtocol": "tcp"
      }
    },

    "PrivateToDirectorInstanceAz1Port25777": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorAz1Cidr" } },
        "FromPort": "25777",
        "ToPort": "25777" ,
        "IpProtocol": "tcp"
      }
    },
    "PrivateToDirectorInstanceAz2Port25777": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "MultiAz",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorAz2Cidr" } },
        "FromPort": "25777",
        "ToPort": "25777" ,
        "IpProtocol": "tcp"
      }
    },


    "PrivateToElastiCacheAz1Port6379": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "CreateElastiCacheInfrastructure",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-ElastiCacheAz1Cidr" } },
        "FromPort": "6379",
        "ToPort": "6379",
        "IpProtocol": "tcp"
      }
    },
    "PrivateToElastiCacheAz2Port6379": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "CreateElastiCacheInfrastructure",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-ElastiCacheAz2Cidr" } },
        "FromPort": "6379",
        "ToPort": "6379",
        "IpProtocol": "tcp"
      }
    },

    "PrivateAz1toPrivate": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateAz1Cidr" } },
        "FromPort": "-1",
        "ToPort": "-1",
        "IpProtocol": "-1"
      }
    },
    "PrivateAz2toPrivate": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "MultiAz",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateAz2Cidr" } },
        "FromPort": "-1",
        "ToPort": "-1",
        "IpProtocol": "-1"
      }
    },
    "PrivateAz3toPrivate": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "MultiAz",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateAz3Cidr" } },
        "FromPort": "-1",
        "ToPort": "-1",
        "IpProtocol": "-1"
      }
    },

    "PrivateToRabbitmqAz1TcpPort8300": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "CreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqAz1Cidr" } },
        "FromPort": "8300",
        "ToPort": "8302",
        "IpProtocol": "tcp"
      }
    },
    "PrivateToRabbitmqAz2TcpPort8300": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "MultiAzAndCreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqAz2Cidr" } },
        "FromPort": "8300",
        "ToPort": "8302",
        "IpProtocol": "tcp"
      }
    },

    "PrivateToRabbitmqAz1UdpPort8300": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "CreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqAz1Cidr" } },
        "FromPort": "8300",
        "ToPort": "8302",
        "IpProtocol": "udp"
      }
    },
    "PrivateToRabbitmqAz2UdpPort8300": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "MultiAzAndCreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqAz2Cidr" } },
        "FromPort": "8300",
        "ToPort": "8302",
        "IpProtocol": "udp"
      }
    },
    "PrivateToS3PrefixListPort80": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "DestinationPrefixListId": { "Fn::FindInMap": [ "PrefixLists", { "Ref": "AWS::Region" }, "s3" ] },
        "FromPort": "80",
        "ToPort": "80",
        "IpProtocol": "tcp"
      }
    },
    "PrivateToS3PrefixListPort443": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "DestinationPrefixListId": { "Fn::FindInMap": [ "PrefixLists", { "Ref": "AWS::Region" }, "s3" ] },
        "FromPort": "443",
        "ToPort": "443",
        "IpProtocol": "tcp"
      }
    },

    "PrivateToAppsRdsAz1Port": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "DeployAppsRdsInstance",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RdsAz1Cidr" } },
        "FromPort": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-AppsRdsInstancePort" } },
        "ToPort": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-AppsRdsInstancePort" } },
        "IpProtocol": "tcp"
      }
    },
    "PrivateToAppsRdsAz2Port": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "DeployAppsRdsInstance",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RdsAz2Cidr" } },
        "FromPort": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-AppsRdsInstancePort" } },
        "ToPort": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-AppsRdsInstancePort" } },
        "IpProtocol": "tcp"
      }
    },
    "PrivateToCfRdsAz1Port": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "DeployAppsRdsInstance",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RdsAz1Cidr" } },
        "FromPort": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-CfRdsInstancePort" } },
        "ToPort": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-CfRdsInstancePort" } },
        "IpProtocol": "tcp"
      }
    },
    "PrivateToCfRdsAz2Port": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "DeployAppsRdsInstance",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RdsAz2Cidr" } },
        "FromPort": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-CfRdsInstancePort" } },
        "ToPort": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-CfRdsInstancePort" } },
        "IpProtocol": "tcp"
      }
    },
    "PrivateToRabbitmqAz1Port4567": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "CreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqAz1Cidr" } },
        "FromPort": "4567",
        "ToPort": "4567",
        "IpProtocol": "tcp"
      }
    },
    "PrivateToRabbitmqAz2Port4567": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "CreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqAz2Cidr" } },
        "FromPort": "4567",
        "ToPort": "4567",
        "IpProtocol": "tcp"
      }
    },
    "PrivateToRabbitmqAz1Port1883": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "CreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqAz1Cidr" } },
        "FromPort": "1883",
        "ToPort": "1883",
        "IpProtocol": "tcp"
      }
    },
    "PrivateToRabbitmqAz2Port1883": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "CreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqAz2Cidr" } },
        "FromPort": "1883",
        "ToPort": "1883",
        "IpProtocol": "tcp"
      }
    },
    "PrivateToRabbitmqAz1Port5671": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "CreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqAz1Cidr" } },
        "FromPort": "5671",
        "ToPort": "5672",
        "IpProtocol": "tcp"
      }
    },
    "PrivateToRabbitmqAz2Port5671": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "CreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqAz2Cidr" } },
        "FromPort": "5671",
        "ToPort": "5672",
        "IpProtocol": "tcp"
      }
    },
    "PrivateToRabbitmqAz1Port15672": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "CreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqAz1Cidr" } },
        "FromPort": "15672",
        "ToPort": "15672",
        "IpProtocol": "tcp"
      }
    },
    "PrivateToRabbitmqAz2Port15672": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "CreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqAz2Cidr" } },
        "FromPort": "15672",
        "ToPort": "15672",
        "IpProtocol": "tcp"
      }
    },
    "PrivateToRabbitmqAz1Port15674": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "CreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqAz1Cidr" } },
        "FromPort": "15674",
        "ToPort": "15674",
        "IpProtocol": "tcp"
      }
    },
    "PrivateToRabbitmqAz2Port15674": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "CreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqAz2Cidr" } },
        "FromPort": "15674",
        "ToPort": "15674",
        "IpProtocol": "tcp"
      }
    },
    "PrivateToExternalNtpCidr1": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalNtpCidr1",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalNtpCidr1" },
        "FromPort": "123",
        "ToPort": "123",
        "IpProtocol": "udp"
      }
    },
    "PrivateToExternalNtpCidr2": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalNtpCidr2",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalNtpCidr2" },
        "FromPort": "123",
        "ToPort": "123",
        "IpProtocol": "udp"
      }
    },
    "PrivateToExternalNtpCidr3": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalNtpCidr3",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalNtpCidr3" },
        "FromPort": "123",
        "ToPort": "123",
        "IpProtocol": "udp"
      }
    },



    "PrivateToExternalRdsAz1Port": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalRdsAz1Cidr",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalRdsAz1Cidr" },
        "FromPort": { "Ref": "ExternalRdsPort" },
        "ToPort": { "Ref": "ExternalRdsPort" },
        "IpProtocol": "tcp"
      }
    },
    "PrivateToExternalRdsAz2Port": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalRdsAz2Cidr",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalRdsAz2Cidr" },
        "FromPort": { "Ref": "ExternalRdsPort" },
        "ToPort": { "Ref": "ExternalRdsPort" },
        "IpProtocol": "tcp"
      }
    },
    "PrivateToExternalRdsAz3Port": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalRdsAz3Cidr",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalRdsAz3Cidr" },
        "FromPort": { "Ref": "ExternalRdsPort" },
        "ToPort": { "Ref": "ExternalRdsPort" },
        "IpProtocol": "tcp"
      }
    },
    "PrivateToExternalRabbitmqAz1Port1": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalRabbitmqAz1Cidr",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalRabbitmqAz1Cidr" },
        "FromPort": { "Ref": "ExternalRabbitmqPort1" },
        "ToPort": { "Ref": "ExternalRabbitmqPort1" },
        "IpProtocol": "tcp"
      }
    },
    "PrivateToExternalRabbitmqAz2Port1": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalRabbitmqAz2Cidr",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalRabbitmqAz2Cidr" },
        "FromPort": { "Ref": "ExternalRabbitmqPort1" },
        "ToPort": { "Ref": "ExternalRabbitmqPort1" },
        "IpProtocol": "tcp"
      }
    },
    "PrivateToExternalRabbitmqAz3Port1": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalRabbitmqAz3Cidr",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalRabbitmqAz3Cidr" },
        "FromPort": { "Ref": "ExternalRabbitmqPort1" },
        "ToPort": { "Ref": "ExternalRabbitmqPort1" },
        "IpProtocol": "tcp"
      }
    },

    "PrivateToExternalRabbitmqAz1Port2": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalRabbitmqAz1CidrPort2",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalRabbitmqAz1Cidr" },
        "FromPort": { "Ref": "ExternalRabbitmqPort2" },
        "ToPort": { "Ref": "ExternalRabbitmqPort2" },
        "IpProtocol": "tcp"
      }
    },
    "PrivateToExternalRabbitmqAz2Port2": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalRabbitmqAz2CidrPort2",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalRabbitmqAz2Cidr" },
        "FromPort": { "Ref": "ExternalRabbitmqPort2" },
        "ToPort": { "Ref": "ExternalRabbitmqPort2" },
        "IpProtocol": "tcp"
      }
    },
    "PrivateToExternalRabbitmqAz3Port3": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalRabbitmqAz3CidrPort2",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalRabbitmqAz3Cidr" },
        "FromPort": { "Ref": "ExternalRabbitmqPort2" },
        "ToPort": { "Ref": "ExternalRabbitmqPort2" },
        "IpProtocol": "tcp"
      }
    },

    "PrivateToExternalSyslogCidr1": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalSyslogCidr1",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalSyslogCidr1" },
        "FromPort": { "Ref": "ExternalSyslogPort" },
        "ToPort": { "Ref": "ExternalSyslogPort" },
        "IpProtocol": { "Ref": "ExternalSyslogProtocol" }
      }
    },
    "PrivateToExternalSyslogCidr2": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalSyslogCidr2",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalSyslogCidr2" },
        "FromPort": { "Ref": "ExternalSyslogPort" },
        "ToPort": { "Ref": "ExternalSyslogPort" },
        "IpProtocol": { "Ref": "ExternalSyslogProtocol" }
      }
    },
    "PrivateToExternalSyslogCidr3": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalSyslogCidr3",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalSyslogCidr3" },
        "FromPort": { "Ref": "ExternalSyslogPort" },
        "ToPort": { "Ref": "ExternalSyslogPort" },
        "IpProtocol": { "Ref": "ExternalSyslogProtocol" }
      }
    },

    "RabbitmqAz1ToRabbitmq": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "CreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqAz1Cidr" } },
        "FromPort": "-1",
        "ToPort": "-1",
        "IpProtocol": "-1"
      }
    },
    "RabbitmqAz2ToRabbitmq": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "MultiAzAndCreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqAz2Cidr" } },
        "FromPort": "-1",
        "ToPort": "-1",
        "IpProtocol": "-1"
      }
    },
    "RabbitmqToDirectorInstanceAz1Port4222": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "CreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorAz1Cidr" } },
        "FromPort": "4222",
        "ToPort": "4222" ,
        "IpProtocol": "tcp"
      }
    },
    "RabbitmqToDirectorInstanceAz2Port4222": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "MultiAzAndCreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorAz2Cidr" } },
        "FromPort": "4222",
        "ToPort": "4222" ,
        "IpProtocol": "tcp"
      }
    },
    "RabbitmqToDirectorInstanceAz1Port25777": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "CreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorAz1Cidr" } },
        "FromPort": "25777",
        "ToPort": "25777" ,
        "IpProtocol": "tcp"
      }
    },
    "RabbitmqToDirectorInstanceAz2Port25777": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "MultiAzAndCreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-DirectorAz2Cidr" } },
        "FromPort": "25777",
        "ToPort": "25777" ,
        "IpProtocol": "tcp"
      }
    },

    "RabbitmqToPrivateAz1TcpPort8300": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "CreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateAz1Cidr" } },
        "FromPort": "8300",
        "ToPort": "8302",
        "IpProtocol": "tcp"
      }
    },
    "RabbitmqToPrivateAz2TcpPort8300": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "MultiAzAndCreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateAz2Cidr" } },
        "FromPort": "8300",
        "ToPort": "8302",
        "IpProtocol": "tcp"
      }
    },
    "RabbitmqToPrivateAz3TcpPort8300": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "MultiAzAndCreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateAz3Cidr" } },
        "FromPort": "8300",
        "ToPort": "8302",
        "IpProtocol": "tcp"
      }
    },
    "RabbitmqToPrivateAz1UdpPort8300": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "CreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateAz1Cidr" } },
        "FromPort": "8300",
        "ToPort": "8302",
        "IpProtocol": "udp"
      }
    },
    "RabbitmqToPrivateAz2UdpPort8300": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "MultiAzAndCreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateAz2Cidr" } },
        "FromPort": "8300",
        "ToPort": "8302",
        "IpProtocol": "udp"
      }
    },
    "RabbitmqToPrivateAz3UdpPort8300": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "MultiAzAndCreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateAz3Cidr" } },
        "FromPort": "8300",
        "ToPort": "8302",
        "IpProtocol": "udp"
      }
    },

    "RabbitmqToPrivateAz1Port4222": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "CreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateAz1Cidr" } },
        "FromPort": "4222",
        "ToPort": "4222",
        "IpProtocol": "tcp"
      }
    },
    "RabbitmqToPrivateAz2Port4222": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "MultiAzAndCreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateAz2Cidr" } },
        "FromPort": "4222",
        "ToPort": "4222",
        "IpProtocol": "tcp"
      }
    },
    "RabbitmqToPrivateAz3Port4222": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "MultiAzAndCreateRabbitmqNetworks",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqSecurityGroup" } },
        "CidrIp": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-PrivateAz3Cidr" } },
        "FromPort": "4222",
        "ToPort": "4222",
        "IpProtocol": "tcp"
      }
    },
    "RabbitMqToExternalNtpCidr1": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalNtpCidr1",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitMqSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalNtpCidr1" },
        "FromPort": "123",
        "ToPort": "123",
        "IpProtocol": "udp"
      }
    },
    "RabbitMqToExternalNtpCidr2": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalNtpCidr2",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitMqSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalNtpCidr2" },
        "FromPort": "123",
        "ToPort": "123",
        "IpProtocol": "udp"
      }
    },
    "RabbitMqToExternalNtpCidr3": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalNtpCidr3",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitMqSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalNtpCidr3" },
        "FromPort": "123",
        "ToPort": "123",
        "IpProtocol": "udp"
      }
    },

    "RabbitmqToExternalSyslogCidr1": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalSyslogCidr1",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalSyslogCidr1" },
        "FromPort": { "Ref": "ExternalSyslogPort" },
        "ToPort": { "Ref": "ExternalSyslogPort" },
        "IpProtocol": { "Ref": "ExternalSyslogProtocol" }
      }
    },
    "RabbitmqToExternalSyslogCidr2": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalSyslogCidr2",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalSyslogCidr2" },
        "FromPort": { "Ref": "ExternalSyslogPort" },
        "ToPort": { "Ref": "ExternalSyslogPort" },
        "IpProtocol": { "Ref": "ExternalSyslogProtocol" }
      }
    },
    "RabbitmqToExternalSyslogCidr3": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Condition": "WhitelistExternalSyslogCidr3",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqSecurityGroup" } },
        "CidrIp": { "Ref": "ExternalSyslogCidr3" },
        "FromPort": { "Ref": "ExternalSyslogPort" },
        "ToPort": { "Ref": "ExternalSyslogPort" },
        "IpProtocol": { "Ref": "ExternalSyslogProtocol" }
      }
    },

    "RabbitmqToS3PrefixListPort80": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqSecurityGroup" } },
        "DestinationPrefixListId": { "Fn::FindInMap": [ "PrefixLists", { "Ref": "AWS::Region" }, "s3" ] },
        "FromPort": "80",
        "ToPort": "80",
        "IpProtocol": "tcp"
      }
    },
    "RabbitmqToS3PrefixListPort443": {
      "Type": "AWS::EC2::SecurityGroupEgress",
      "Properties": {
        "GroupId": { "Fn::ImportValue": { "Fn::Sub": "${DeploymentName}-RabbitmqSecurityGroup" } },
        "DestinationPrefixListId": { "Fn::FindInMap": [ "PrefixLists", { "Ref": "AWS::Region" }, "s3" ] },
        "FromPort": "443",
        "ToPort": "443",
        "IpProtocol": "tcp"
      }
    }
  }
}
